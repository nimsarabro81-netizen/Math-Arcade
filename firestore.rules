/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a public-read, admin-write model for game settings, and restricts leaderboard management (creation, modification, deletion) to authenticated users only.
 *
 * Data Structure:
 * - /gameSettings: Stores global game settings. Anyone can read, only authenticated users with admin privileges can write.
 * - /userRanks, /algebraRanks, /equationRanks: Store public leaderboard data.
 *
 * Key Security Decisions:
 * - Leaderboards are publicly readable to encourage community engagement.
 * - Only authenticated users can create, update, or delete leaderboard entries. A more sophisticated role-based system would be appropriate in a production environment.
 * - User listing is generally disallowed to protect user privacy.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read game settings, but restricts writes to authenticated users.
     * @path /gameSettings
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Public read, admin-only write. Authenticated users can modify game settings.
     */
    match /gameSettings/{gameSettingId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read the VectorZen leaderboard, but restricts writes to authenticated users.
     * @path /userRanks
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Public read, admin-only write. Authenticated users can modify leaderboard.
     */
    match /userRanks/{userRankId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

      /**
       * @description Allows anyone to read the Algebra Arena leaderboard, but restricts writes to authenticated users.
       * @path /algebraRanks
       * @allow (get, list)
       * @deny (create, update, delete)
       * @principle Public read, admin-only write. Authenticated users can modify leaderboard.
       */
    match /algebraRanks/{algebraRankId} {
        allow get, list: if true;
        allow create, update, delete: if isSignedIn();
    }

      /**
       * @description Allows anyone to read the Equation Equilibrium leaderboard, but restricts writes to authenticated users.
       * @path /equationRanks
       * @allow (get, list)
       * @deny (create, update, delete)
       * @principle Public read, admin-only write. Authenticated users can modify leaderboard.
       */
    match /equationRanks/{equationRankId} {
        allow get, list: if true;
        allow create, update, delete: if isSignedIn();
    }

    // --- Helper Functions ---

    /**
     * @description Checks if the user is signed in.
     * @return {bool} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}